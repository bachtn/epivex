****************************** TODO ************************************
Optimise resolution algorithm: use smart pointers?
